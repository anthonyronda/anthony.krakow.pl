---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';
import { t, locales } from '../../i18n/utils';
import type { Locale } from '../../i18n/utils';

export function getStaticPaths() {
  return locales.map((locale) => ({ params: { locale } }));
}

const { locale } = Astro.params as { locale: Locale };

const notes = (await getCollection(locale))
  .filter((n) => !n.data.draft && (import.meta.env.DEV || !n.data.tags.includes('dev-only')))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---
<Layout title={undefined} locale={locale}>
  <section>
    <p class="intro">{t('home.intro', locale)}</p>
    <h2 style="margin-top:2rem;">{t('home.recent', locale)}</h2>
    {notes.length === 0 && <p class="muted">No notes yet.</p>}
    <ul class="note-list">
      {notes.map((note) => (
        <li>
          <a href={`/${locale}/${note.slug}`}>{note.data.title}</a>
          <span class="muted"> â€” {note.data.pubDate.toLocaleDateString()}</span>
          {note.data.tags.length > 0 && (
            <span>
              {note.data.tags.map((tag) => (
                <a href={`/${locale}/tags/${tag}`} class="tag">{tag}</a>
              ))}
            </span>
          )}
          {note.data.description && <p class="muted" style="margin:0.2em 0 0;">{note.data.description}</p>}
        </li>
      ))}
    </ul>
  </section>
</Layout>

<style>
  .intro { font-size: 1.1rem; color: #333; }
  .note-list { list-style: none; margin-top: 1rem; }
  .note-list li { padding: 0.75rem 0; border-bottom: 1px solid var(--color-border); }
  .note-list li:last-child { border-bottom: none; }
  .note-list a { font-weight: 600; text-decoration: none; }
  .note-list a:hover { text-decoration: underline; }
</style>
